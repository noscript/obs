#!/usr/bin/make -f

define substitute
	find . -type f | xargs sed -i -e 's/$(1)/$(2)/g'
endef

build: build-stamp
build-stamp:
	dh_testdir
	sed -i 's/Numix/Numix-dark/' Makefile

	pushd src/gtk-2.0
	$(call substitute,'base_color:#[0-9a-f]\+','base_color:#333333')
	$(call substitute,'bg_color:#[0-9a-f]\+','bg_color:#2d2d2d')
	$(call substitute,'fg_color:#[0-9a-f]\+','fg_color:#dcdcdc')
	$(call substitute,'link_color:#[0-9a-f]\+','link_color:#fc6f5d')
	$(call substitute,'menu_bg_color:#[0-9a-f]\+','menu_bg_color:#2d2d2d')
	$(call substitute,'menu_fg_color:#[0-9a-f]\+','menu_fg_color:#dcdcdc')
	$(call substitute,'menubar_bg_color:#[0-9a-f]\+','menubar_bg_color:#2d2d2d')
	$(call substitute,'menubar_fg_color:#[0-9a-f]\+','menubar_fg_color:#dcdcdc')
	$(call substitute,'panel_bg_color:#[0-9a-f]\+','panel_bg_color:#2d2d2d')
	$(call substitute,'panel_fg_color:#[0-9a-f]\+','panel_fg_color:#dcdcdc')
	$(call substitute,'selected_bg_color:#[0-9a-f]\+','selected_bg_color:#404040')
	$(call substitute,'selected_fg_color:#[0-9a-f]\+','selected_fg_color:#f9f9f9')
	$(call substitute,'text_color:#[0-9a-f]\+','text_color:#dedede')
	$(call substitute,'toolbar_bg_color:#[0-9a-f]\+','toolbar_bg_color:#2d2d2d')
	$(call substitute,'toolbar_fg_color:#[0-9a-f]\+','toolbar_fg_color:#dcdcdc')
	$(call substitute,'tooltip_bg_color:#[0-9a-f]\+','tooltip_bg_color:#2d2d2d')
	$(call substitute,'tooltip_fg_color:#[0-9a-f]\+','tooltip_fg_color:#dedede')
	$(call substitute,'titlebar_bg_color:#[0-9a-f]\+','titlebar_bg_color:#2d2d2d')
	$(call substitute,'titlebar_fg_color:#[0-9a-f]\+','titlebar_fg_color:#dcdcdc')
	popd

	pushd src/gtk-3.0
	$(call substitute,'$base_color:.*$','$base_color: #333333;')
	$(call substitute,'$bg_color:.*$','$bg_color: #2d2d2d;')
	$(call substitute,'$fg_color:.*$','$fg_color: #dcdcdc;')
	$(call substitute,'$link_color:.*$','$link_color: #fc6f5d;')
	$(call substitute,'$menu_bg_color:.*$','$menu_bg_color: #2d2d2d;')
	$(call substitute,'$menu_fg_color:.*$','$menu_fg_color: #dcdcdc;')
	$(call substitute,'$menubar_bg_color:.*$','$menubar_bg_color: #2d2d2d;')
	$(call substitute,'$menubar_fg_color:.*$','$menubar_fg_color: #dcdcdc;')
	$(call substitute,'$panel_bg_color:.*$','$panel_bg_color: #2d2d2d;')
	$(call substitute,'$panel_fg_color:.*$','$panel_fg_color: #dcdcdc;')
	$(call substitute,'$selected_bg_color:.*$','$selected_bg_color: #404040;')
	$(call substitute,'$selected_fg_color:.*$','$selected_fg_color: #f9f9f9;')
	$(call substitute,'$text_color:.*$','$text_color: #dedede;')
	$(call substitute,'$toolbar_bg_color:.*$','$toolbar_bg_color: #2d2d2d;')
	$(call substitute,'$toolbar_fg_color:.*$','$toolbar_fg_color: #dcdcdc;')
	$(call substitute,'$tooltip_bg_color:.*$','$tooltip_bg_color: #2d2d2d;')
	$(call substitute,'$tooltip_fg_color:.*$','$tooltip_fg_color: #dedede;')
	$(call substitute,'$titlebar_bg_color:.*$','$titlebar_bg_color: #2d2d2d;')
	$(call substitute,'$titlebar_fg_color:.*$','$titlebar_fg_color: #dcdcdc;')

	#$(call substitute,'$dark_bg_color:.*$','$dark_bg_color: #00ff00;')
	#$(call substitute,'$dark_fg_color:.*$','$dark_fg_color: #00ff00;')
	#$(call substitute,'$dark_shadow:.*$','$dark_shadow: #00ff00;')
	#$(call substitute,'$light_shadow:.*$','$light_shadow: #00ff00;')
	#$(call substitute,'$black:.*$','$black: #00ff00;')
	#$(call substitute,'$white:.*$','$white: #00ff00;')
	#$(call substitute,'$info_fg_color:.*$;','$info_fg_color: #00ff00;')
	#$(call substitute,'$info_bg_color:.*$','$info_bg_color: #00ff00;')
	#$(call substitute,'$warning_fg_color:.*$','$warning_fg_color: #00ff00;')
	#$(call substitute,'$warning_bg_color:.*$','$warning_bg_color: #00ff00;')
	#$(call substitute,'$question_fg_color:.*$','$question_fg_color: #00ff00;')
	#$(call substitute,'$question_bg_color:.*$','$question_bg_color: #00ff00;')
	#$(call substitute,'$error_fg_color:.*$','$error_fg_color: #00ff00;')
	#$(call substitute,'$error_bg_color:.*$','$error_bg_color: #00ff00;')
	#$(call substitute,'$link_color:.*$','$link_color: #00ff00;')
	#$(call substitute,'$success_color:.*$','$success_color: #00ff00;')
	#$(call substitute,'$warning_color:.*$','$warning_color: #00ff00;')
	#$(call substitute,'$error_color:.*$','$error_color: #00ff00;')
	popd

	pushd src/gtk-3.20
	$(call substitute,'$base_color:.*$','$base_color: #333333;')
	$(call substitute,'$bg_color:.*$','$bg_color: #2d2d2d;')
	$(call substitute,'$fg_color:.*$','$fg_color: #dcdcdc;')
	$(call substitute,'$link_color:.*$','$link_color: #fc6f5d;')
	$(call substitute,'$menu_bg_color:.*$','$menu_bg_color: #2d2d2d;')
	$(call substitute,'$menu_fg_color:.*$','$menu_fg_color: #dcdcdc;')
	$(call substitute,'$menubar_bg_color:.*$','$menubar_bg_color: #2d2d2d;')
	$(call substitute,'$menubar_fg_color:.*$','$menubar_fg_color: #dcdcdc;')
	$(call substitute,'$panel_bg_color:.*$','$panel_bg_color: #2d2d2d;')
	$(call substitute,'$panel_fg_color:.*$','$panel_fg_color: #dcdcdc;')
	$(call substitute,'$selected_bg_color:.*$','$selected_bg_color: #404040;')
	$(call substitute,'$selected_fg_color:.*$','$selected_fg_color: #f9f9f9;')
	$(call substitute,'$text_color:.*$','$text_color: #dedede;')
	$(call substitute,'$toolbar_bg_color:.*$','$toolbar_bg_color: #2d2d2d;')
	$(call substitute,'$toolbar_fg_color:.*$','$toolbar_fg_color: #dcdcdc;')
	$(call substitute,'$tooltip_bg_color:.*$','$tooltip_bg_color: #2d2d2d;')
	$(call substitute,'$tooltip_fg_color:.*$','$tooltip_fg_color: #dedede;')
	$(call substitute,'$titlebar_bg_color:.*$','$titlebar_bg_color: #2d2d2d;')
	$(call substitute,'$titlebar_fg_color:.*$','$titlebar_fg_color: #dcdcdc;')
	popd

	pushd src/openbox-3
	$(call substitute,'#444444','#2d2d2d')
	$(call substitute,'#f06860','#404040')
	$(call substitute,'#eeeeee','#dcdcdc')
	popd

	make
	touch build-stamp

clean:
	dh_testdir
	dh_testroot
	rm -f build-stamp
	make clean || true
	dh_clean

install: build
	dh_testdir
	dh_testroot
	dh_clean -k
	make install DESTDIR=$(CURDIR)/debian/tmp

binary-indep: build install

binary-arch: build install
	dh_testdir
	dh_testroot
	dh_install
	dh_installchangelogs
	dh_installdeb
	dh_shlibdeps
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install

